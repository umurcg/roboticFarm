if(typeof module==="undefined")module={exports:{}};module.exports=function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";if(location.hostname.indexOf("worldcat.org")!==-1){__webpack_require__(1).fixAll()}var iframe=__webpack_require__(2);var scriptElements=Array.prototype.slice.call(document.querySelectorAll("script"));var bookmarkletScriptEl=scriptElements.find(function(scriptEl){return scriptEl.src&&scriptEl.src.match(/(mendeley\.com|localhost).+bookmarklet/)});var queryString=bookmarkletScriptEl&&bookmarkletScriptEl.src.split("?")[1]||"";var queryParams=queryString.split("&").reduce(function(result,pair){var tempArray=pair.split("=");var key=decodeURIComponent(tempArray[0]);var val=decodeURIComponent(tempArray[1]);if(key){result[key]=val}return result},{});queryParams.bookmarklet=true;iframe.show(queryParams)},function(module,exports){"use strict";function reduce(accumlator){var i;var l=this.length;var curr;if(typeof accumlator!=="function"){throw new TypeError("First argument is not callable")}if((l===0||l===false||l===null)&&arguments.length<=1){throw new TypeError("Array length is 0 and no second argument")}if(arguments.length<=1){curr=this[0];i=1}else{curr=arguments[1]}for(i=i||0;i<l;++i){if(i in this){curr=accumlator(curr,this[i],i,this)}}return curr}function find(predicate,thisValue){var arr=Object(this);if(typeof predicate!=="function"){throw new TypeError}for(var i=0;i<arr.length;i++){if(i in arr){var elem=arr[i];if(predicate.call(thisValue,elem,i,arr)){return elem}}}return}function some(a,b,c){for(c=0;c<this.length;c++){if(a.call(b,this[c],c,this)){return true}}return false}function fixAll(){var proto=Array.prototype;proto.reduce=reduce;proto.find=find;proto.some=some}module.exports={reduce:reduce,find:find,some:some,fixAll:fixAll}},function(module,exports,__webpack_require__){"use strict";var messaging=__webpack_require__(3);var config=__webpack_require__(8);var scrape=__webpack_require__(9);var iframe=document.getElementById("mendeley-import-panel-iframe");var containerDiv=iframe?iframe.parentElement:null;var closeButtonHack=document.getElementById("mendeley-close-button-hack");if(typeof window.closeButtonHackShowAgain==="undefined"){window.closeButtonHackShowAgain=true}function sendMessage(message,transfer){iframe.contentWindow.postMessage(message,"*",transfer)}function iframeMessageHandler(event){var data=event.data;if(data.action==="scrape-documents"){scrape(document,document.location.href).then(function(documents){sendMessage({action:"scrape-documents.success",url:document.location.href,documents:documents,pageTitle:document.title})}).done()}if(data.action==="fetch-file"){messaging.send({action:"content:fetch-file",url:data.url,documentId:data.documentId})}if(data.action==="hide-panel"){containerDiv.style.display="none";closeButtonHack.style.display="none";window.closeButtonHackShowAgain=false}if(data.action==="close-button-hack"){closeButtonHack.style.display="none";window.closeButtonHackShowAgain=false}}function buildCloseButtonHack(){closeButtonHack=document.createElement("img");closeButtonHack.id="mendeley-close-button-hack";closeButtonHack.addEventListener("click",function(){containerDiv.style.display="none";closeButtonHack.style.display="none"});closeButtonHack.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNDMxM0JBQUFCRTUxMUUyODZCQ0IyQzQxNEVBNDQ0NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozNEI0Q0E1NkFDMDExMUUyODZCQ0IyQzQxNEVBNDQ0NyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjE0MzEzQkE4QUJFNTExRTI4NkJDQjJDNDE0RUE0NDQ3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjE0MzEzQkE5QUJFNTExRTI4NkJDQjJDNDE0RUE0NDQ3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+VICatgAAA6dJREFUeNqcVktLW1EQnjxMKqkhVdMKWogKUmsNVLCmixSJXVgXsauCIAguXBb8A1JcKd26VXBbUNBNu9AgFKJWpSRqQy2RgA+sBhMrVZOY3M53ODdc85DUgUnOnTPzfec5c3RUXHTQeDzeZTab3Uaj8aXBYHiq0+keKYryO51O/7i+vl5OJBJfbTbbIvsqUksSgBtisdhbBgooJQj84I84GZ8HmPttTKVSn3nkXTBsbm7S2toaBYNB2t3dpWg0StXV1dTQ0EBOp5Pa29uptbVVBPPMFsvKyt6gqZ2VrgDBKhM839/fp7m5OZqfn6fT09Oi066srCSv10u9vb1UV1cHou9M1KEl0mkJksnkF3bwbG9v09TUFC0tLZW6xNTZ2UmDg4PU0tJCPFCfyWTqVon00kd/eHjoBQFmMDk5ST6fjzKZTMkKf8QhHjjAAy7JHzELXucPMMzMzNDCwgLxZv63Ig7xEIlnBL4gCYfDr5n9WSAQoNnZ2bxRjo2NFRx9ITvigQM84KokBqvV+grsfr+fjo+Pb4xufHycenp6aGtr64Yd37CjX2tHPHAgEtcgSMrLy3EaaGNjI28JhoeHs5sbCoWEDf+qoD83BjgQiStI9Hyjn2hBcrWxsTELurOzk23DXshfHYTE1WPT7/OljYNRDSomkUgk23Y4HEX9OP0Q7weaaU5DNrHxfIGisFRVVRU9OVoClbCYL3BkBoiqG69cXFz8grGpqangKdrb28uC19bWZtuwF/IHDkTiisuY4bQhdqqtrS1vVBMTE1nQmpoaYcO/KujPjQEOROJmBAlPfRlGt9stcpE2YGhoSJx9u91+w45v2NGvtSMeOHJJgZtBu4zVfn5+/hNpe3R0VGHHOyviIcADLvAxExynq/X19Y9g7O/vp+7u7julFcQhHiLxriS+yF1m1oe8hn6Mgi+T0tfXp1RUVJSs8EccBDjAk7jZcoKKZmF9fHZ2FoIjFyhlZGREqa+vVywWS1FFP/zgD0E8cCSeIa+eIBOwPjg5OfnEWfQFOlZXV0UaX1lZIdSZo6MjcbpQN1wuF3k8HuroEFkJVfMbH4h33IyxXuZWSJUIh8CKkfDJec91O1xKjYcf/OUMrBJHd2uNZzXJ6Vqnp6e7mpubXXwJnfwqcXDSs11eXvIjJh45ODgIcp5aGRgYwGvlD+tf1uRtNV5r02vI7kk1a0YIgBRrQp6gKw14ptAS3frukptnkMR6DUlGalpq0XfXPwEGAC/2hSkSgXukAAAAAElFTkSuQmCC";closeButtonHack.style.cssText=["position: absolute","right: 353px","top: 10px","z-index: 999999999","cursor: pointer"].join(";");document.body.appendChild(closeButtonHack)}function buildPanel(options){options=options||{};containerDiv=document.createElement("div");iframe=document.createElement("iframe");containerDiv.style.cssText=["position: fixed;","top: 20px;","right: 35px;","bottom: 20px;","margin: 0px;","padding: 0px;","z-index: 99999999;","box-shadow: 3px 3px 20px rgba(0, 0, 0, 0.3);","background: #F6F6F6;"].join(" ");var queryString=Object.keys(options).map(function(key){return encodeURIComponent(key)+"="+encodeURIComponent(options[key])}).join("&");iframe.id="mendeley-import-panel-iframe";iframe.src=config.WEBLET_URL+(queryString?"?"+queryString:"");iframe.style.cssText=["width: 335px","height: 100%","border-width: 0","margin: 0","padding: 0"].join(";");iframe.frameBorder=0;containerDiv.appendChild(iframe);document.body.appendChild(containerDiv);window.addEventListener("message",iframeMessageHandler)}function showPanel(options){if(!iframe){buildPanel(options)}else{containerDiv.style.display="block"}if(!closeButtonHack){buildCloseButtonHack()}else if(window.closeButtonHackShowAgain){closeButtonHack.style.display="block"}}module.exports={show:showPanel,send:sendMessage}},function(module,exports,__webpack_require__){"use strict";var fetchFile=__webpack_require__(4);function send(message){var iframe=__webpack_require__(2);if(message.action!=="content:fetch-file"){return}fetchFile(message.url).then(function(result){iframe.send({action:"fetch-file.success",documentId:message.documentId,fileName:result.fileName,contentType:result.contentType,file:result.file},[result.file])},function(){iframe.send({action:"fetch-file.fail",documentId:message.documentId,url:message.url})},function(ev){iframe.send({action:"fetch-file.progress",documentId:message.documentId,loaded:ev.loaded,total:ev.total})})}module.exports={send:send,listen:function(){}}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);module.exports=function fetchFile(url){return Q.Promise(function(resolve,reject,notify){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.addEventListener("error",reject);xhr.addEventListener("progress",notify);xhr.addEventListener("load",function(){if(xhr.status>=200&&xhr.status<400||xhr.status===0){resolve({file:xhr.response,fileName:"full-text.pdf",contentType:xhr.getResponseHeader("content-type")})}else{reject()}});xhr.send()})}},function(module,exports,__webpack_require__){(function(process,setImmediate){"use strict";(function(definition){"use strict";if(typeof bootstrap==="function"){bootstrap("promise",definition)}else if(true){module.exports=definition()}else if(typeof define==="function"&&define.amd){define(definition)}else if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=definition}}else if(typeof window!=="undefined"||typeof self!=="undefined"){var global=typeof window!=="undefined"?window:self;var previousQ=global.Q;global.Q=definition();global.Q.noConflict=function(){global.Q=previousQ;return this}}else{throw new Error("This environment was not anticipated by Q. Please file a bug.")}})(function(){"use strict";var hasStacks=false;try{throw new Error}catch(e){hasStacks=!!e.stack}var qStartingLine=captureLine();var qFileName;var noop=function(){};var nextTick=function(){var head={task:void 0,next:null};var tail=head;var flushing=false;var requestTick=void 0;var isNodeJS=false;var laterQueue=[];function flush(){var task,domain;while(head.next){head=head.next;task=head.task;head.task=void 0;domain=head.domain;if(domain){head.domain=void 0;domain.enter()}runSingle(task,domain)}while(laterQueue.length){task=laterQueue.pop();runSingle(task)}flushing=false}function runSingle(task,domain){try{task()}catch(e){if(isNodeJS){if(domain){domain.exit()}setTimeout(flush,0);if(domain){domain.enter()}throw e}else{setTimeout(function(){throw e},0)}}if(domain){domain.exit()}}nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null};if(!flushing){flushing=true;requestTick()}};if(typeof process==="object"&&process.toString()==="[object process]"&&process.nextTick){isNodeJS=true;requestTick=function(){process.nextTick(flush)}}else if(typeof setImmediate==="function"){if(typeof window!=="undefined"){requestTick=setImmediate.bind(window,flush)}else{requestTick=function(){setImmediate(flush)}}}else if(typeof MessageChannel!=="undefined"){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick;channel.port1.onmessage=flush;flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0);requestPortTick()}}else{requestTick=function(){setTimeout(flush,0)}}nextTick.runAfter=function(task){laterQueue.push(task);if(!flushing){flushing=true;requestTick()}};return nextTick}();var call=Function.call;function uncurryThis(f){return function(){return call.apply(f,arguments)}}var array_slice=uncurryThis(Array.prototype.slice);var array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(arguments.length===1){do{if(index in this){basis=this[index++];break}if(++index>=length){throw new TypeError}}while(1)}for(;index<length;index++){if(index in this){basis=callback(basis,this[index],index)}}return basis});var array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++){if(this[i]===value){return i}}return-1});var array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this;var collect=[];array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0);return collect});var object_create=Object.create||function(prototype){function Type(){}Type.prototype=prototype;return new Type};var object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty);var object_keys=Object.keys||function(object){var keys=[];for(var key in object){if(object_hasOwnProperty(object,key)){keys.push(key)}}return keys};var object_toString=uncurryThis(Object.prototype.toString);function isObject(value){return value===Object(value)}function isStopIteration(exception){return object_toString(exception)==="[object StopIteration]"||exception instanceof QReturnValue}var QReturnValue;if(typeof ReturnValue!=="undefined"){QReturnValue=ReturnValue}else{QReturnValue=function(value){this.value=value}}var STACK_JUMP_SEPARATOR="From previous event:";function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&typeof error==="object"&&error!==null&&error.stack&&error.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){var stacks=[];for(var p=promise;!!p;p=p.source){if(p.stack){stacks.unshift(p.stack)}}stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){var lines=stackString.split("\n");var desiredLines=[];for(var i=0;i<lines.length;++i){var line=lines[i];if(!isInternalFrame(line)&&!isNodeFrame(line)&&line){desiredLines.push(line)}}return desiredLines.join("\n")}function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1){return[attempt1[1],Number(attempt1[2])]}var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2){return[attempt2[1],Number(attempt2[2])]}var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);if(attempt3){return[attempt3[1],Number(attempt3[2])]}}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber){return false}var fileName=fileNameAndLineNumber[0];var lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&lineNumber<=qEndingLine}function captureLine(){if(!hasStacks){return}try{throw new Error}catch(e){var lines=e.stack.split("\n");var firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2];var fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber){return}qFileName=fileNameAndLineNumber[0];return fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack)}return callback.apply(callback,arguments)}}function Q(value){if(value instanceof Promise){return value}if(isPromiseAlike(value)){return coerce(value)}else{return fulfill(value)}}Q.resolve=Q;Q.nextTick=nextTick;Q.longStackSupport=false;if(typeof process==="object"&&process&&process.env&&process.env.Q_DEBUG){Q.longStackSupport=true}Q.defer=defer;function defer(){var messages=[],progressListeners=[],resolvedPromise;var deferred=object_create(defer.prototype);var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);if(messages){messages.push(args);if(op==="when"&&operands[1]){progressListeners.push(operands[1])}}else{Q.nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})}};promise.valueOf=function(){if(messages){return promise}var nearerValue=nearer(resolvedPromise);if(isPromise(nearerValue)){resolvedPromise=nearerValue}return nearerValue};promise.inspect=function(){if(!resolvedPromise){return{state:"pending"}}return resolvedPromise.inspect()};if(Q.longStackSupport&&hasStacks){try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1)}}function become(newPromise){resolvedPromise=newPromise;promise.source=newPromise;array_reduce(messages,function(undefined,message){Q.nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0);messages=void 0;progressListeners=void 0}deferred.promise=promise;deferred.resolve=function(value){if(resolvedPromise){return}become(Q(value))};deferred.fulfill=function(value){if(resolvedPromise){return}become(fulfill(value))};deferred.reject=function(reason){if(resolvedPromise){return}become(reject(reason))};deferred.notify=function(progress){if(resolvedPromise){return}array_reduce(progressListeners,function(undefined,progressListener){Q.nextTick(function(){progressListener(progress)})},void 0)};return deferred}defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){if(error){self.reject(error)}else if(arguments.length>2){self.resolve(array_slice(arguments,1))}else{self.resolve(value)}}};Q.Promise=promise;Q.promise=promise;function promise(resolver){if(typeof resolver!=="function"){throw new TypeError("resolver must be a function.")}var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}promise.race=race;promise.all=all;promise.reject=reject;promise.resolve=Q;Q.passByCopy=function(object){return object};Promise.prototype.passByCopy=function(){return this};Q.join=function(x,y){return Q(x).join(y)};Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y){return x}else{throw new Error("Can't join: not the same: "+x+" "+y)}})};Q.race=race;function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;i<len;i++){Q(answerPs[i]).then(resolve,reject)}})}Promise.prototype.race=function(){return this.then(Q.race)};Q.makePromise=Promise;function Promise(descriptor,fallback,inspect){if(fallback===void 0){fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}}if(inspect===void 0){inspect=function(){return{state:"unknown"}}}var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,args){var result;try{if(descriptor[op]){result=descriptor[op].apply(promise,args)}else{result=fallback.call(promise,op,args)}}catch(exception){result=reject(exception)}if(resolve){resolve(result)}};promise.inspect=inspect;if(inspect){var inspected=inspect();if(inspected.state==="rejected"){promise.exception=inspected.reason}promise.valueOf=function(){var inspected=inspect();if(inspected.state==="pending"||inspected.state==="rejected"){return promise}return inspected.value}}return promise}Promise.prototype.toString=function(){return"[object Promise]"};Promise.prototype.then=function(fulfilled,rejected,progressed){var self=this;var deferred=defer();var done=false;function _fulfilled(value){try{return typeof fulfilled==="function"?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if(typeof rejected==="function"){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return typeof progressed==="function"?progressed(value):value}Q.nextTick(function(){self.promiseDispatch(function(value){if(done){return}done=true;deferred.resolve(_fulfilled(value))},"when",[function(exception){if(done){return}done=true;deferred.resolve(_rejected(exception))}])});self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue;var threw=false;try{newValue=_progressed(value)}catch(e){threw=true;if(Q.onerror){Q.onerror(e)}else{throw e}}if(!threw){deferred.notify(newValue)}}]);return deferred.promise};Q.tap=function(promise,callback){return Q(promise).tap(callback)};Promise.prototype.tap=function(callback){callback=Q(callback);return this.then(function(value){return callback.fcall(value).thenResolve(value)})};Q.when=when;function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}Promise.prototype.thenResolve=function(value){return this.then(function(){return value})};Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)};Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})};Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)};Q.nearer=nearer;function nearer(value){if(isPromise(value)){var inspected=value.inspect();if(inspected.state==="fulfilled"){return inspected.value}}return value}Q.isPromise=isPromise;function isPromise(object){return object instanceof Promise}Q.isPromiseAlike=isPromiseAlike;function isPromiseAlike(object){return isObject(object)&&typeof object.then==="function"}Q.isPending=isPending;function isPending(object){return isPromise(object)&&object.inspect().state==="pending"}Promise.prototype.isPending=function(){return this.inspect().state==="pending"};Q.isFulfilled=isFulfilled;function isFulfilled(object){return!isPromise(object)||object.inspect().state==="fulfilled"}Promise.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};Q.isRejected=isRejected;function isRejected(object){return isPromise(object)&&object.inspect().state==="rejected"}Promise.prototype.isRejected=function(){return this.inspect().state==="rejected"};var unhandledReasons=[];var unhandledRejections=[];var reportedUnhandledRejections=[];var trackUnhandledRejections=true;function resetUnhandledRejections(){unhandledReasons.length=0;unhandledRejections.length=0;if(!trackUnhandledRejections){trackUnhandledRejections=true}}function trackRejection(promise,reason){if(!trackUnhandledRejections){return}if(typeof process==="object"&&typeof process.emit==="function"){Q.nextTick.runAfter(function(){if(array_indexOf(unhandledRejections,promise)!==-1){process.emit("unhandledRejection",reason,promise);reportedUnhandledRejections.push(promise)}})}unhandledRejections.push(promise);if(reason&&typeof reason.stack!=="undefined"){unhandledReasons.push(reason.stack)}else{unhandledReasons.push("(no stack) "+reason)}}function untrackRejection(promise){if(!trackUnhandledRejections){return}var at=array_indexOf(unhandledRejections,promise);if(at!==-1){if(typeof process==="object"&&typeof process.emit==="function"){Q.nextTick.runAfter(function(){var atReport=array_indexOf(reportedUnhandledRejections,promise);if(atReport!==-1){process.emit("rejectionHandled",unhandledReasons[at],promise);reportedUnhandledRejections.splice(atReport,1)}})}unhandledRejections.splice(at,1);unhandledReasons.splice(at,1)}}Q.resetUnhandledRejections=resetUnhandledRejections;Q.getUnhandledReasons=function(){return unhandledReasons.slice()};Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections();trackUnhandledRejections=false};resetUnhandledRejections();Q.reject=reject;function reject(reason){var rejection=Promise({when:function(rejected){if(rejected){untrackRejection(this)}return rejected?rejected(reason):this}},function fallback(){return this},function inspect(){return{state:"rejected",reason:reason}});trackRejection(rejection,reason);return rejection}Q.fulfill=fulfill;function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},delete:function(name){delete value[name]},post:function(name,args){if(name===null||name===void 0){return value.apply(void 0,args)}else{return value[name].apply(value,args)}},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function inspect(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();Q.nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}});return deferred.promise}Q.master=master;function master(object){return Promise({isDef:function(){}},function fallback(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}Q.spread=spread;function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)};Q.async=async;function async(makeGenerator){return function(){function continuer(verb,arg){var result;if(typeof StopIteration==="undefined"){try{result=generator[verb](arg)}catch(exception){return reject(exception)}if(result.done){return Q(result.value)}else{return when(result.value,callback,errback)}}else{try{result=generator[verb](arg)}catch(exception){if(isStopIteration(exception)){return Q(exception.value)}else{return reject(exception)}}return when(result,callback,errback)}}var generator=makeGenerator.apply(this,arguments);var callback=continuer.bind(continuer,"next");var errback=continuer.bind(continuer,"throw");return callback()}}Q.spawn=spawn;function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}Q["return"]=_return;function _return(value){throw new QReturnValue(value)}Q.promised=promised;function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}Q.dispatch=dispatch;function dispatch(object,op,args){return Q(object).dispatch(op,args)}Promise.prototype.dispatch=function(op,args){var self=this;var deferred=defer();Q.nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)});return deferred.promise};Q.get=function(object,key){return Q(object).dispatch("get",[key])};Promise.prototype.get=function(key){return this.dispatch("get",[key])};Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])};Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])};Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])};Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])};Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])};Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])};Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])};Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])};Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])};Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])};Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])};Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])};Q.fbind=function(object){var promise=Q(object);var args=array_slice(arguments,1);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}};Promise.prototype.fbind=function(){var promise=this;var args=array_slice(arguments);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}};Q.keys=function(object){return Q(object).dispatch("keys",[])};Promise.prototype.keys=function(){return this.dispatch("keys",[])};Q.all=all;function all(promises){return when(promises,function(promises){var pendingCount=0;var deferred=defer();array_reduce(promises,function(undefined,promise,index){var snapshot;if(isPromise(promise)&&(snapshot=promise.inspect()).state==="fulfilled"){promises[index]=snapshot.value}else{++pendingCount;when(promise,function(value){promises[index]=value;if(--pendingCount===0){deferred.resolve(promises)}},deferred.reject,function(progress){deferred.notify({index:index,value:progress})})}},void 0);if(pendingCount===0){deferred.resolve(promises)}return deferred.promise})}Promise.prototype.all=function(){return all(this)};Q.any=any;function any(promises){if(promises.length===0){return Q.resolve()}var deferred=Q.defer();var pendingCount=0;array_reduce(promises,function(prev,current,index){var promise=promises[index];pendingCount++;when(promise,onFulfilled,onRejected,onProgress);function onFulfilled(result){deferred.resolve(result)}function onRejected(){pendingCount--;if(pendingCount===0){deferred.reject(new Error("Can't get fulfillment value from any promise, all "+"promises were rejected."))}}function onProgress(progress){deferred.notify({index:index,value:progress})}},undefined);return deferred.promise}Promise.prototype.any=function(){return any(this)};Q.allResolved=deprecate(allResolved,"allResolved","allSettled");function allResolved(promises){return when(promises,function(promises){promises=array_map(promises,Q);return when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}Promise.prototype.allResolved=function(){return allResolved(this)};Q.allSettled=allSettled;function allSettled(promises){return Q(promises).allSettled()}Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){promise=Q(promise);function regardless(){return promise.inspect()}return promise.then(regardless,regardless)}))})};Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)};Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)};Q.progress=progress;function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)};Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)};Promise.prototype.fin=Promise.prototype["finally"]=function(callback){callback=Q(callback);return this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})};Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)};Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){Q.nextTick(function(){makeStackTraceLong(error,promise);if(Q.onerror){Q.onerror(error)}else{throw error}})};var promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;if(typeof process==="object"&&process&&process.domain){onUnhandledError=process.domain.bind(onUnhandledError)}promise.then(void 0,onUnhandledError)};Q.timeout=function(object,ms,error){return Q(object).timeout(ms,error)};Promise.prototype.timeout=function(ms,error){var deferred=defer();var timeoutId=setTimeout(function(){if(!error||"string"===typeof error){error=new Error(error||"Timed out after "+ms+" ms");error.code="ETIMEDOUT"}deferred.reject(error)},ms);this.then(function(value){clearTimeout(timeoutId);deferred.resolve(value)},function(exception){clearTimeout(timeoutId);deferred.reject(exception)},deferred.notify);return deferred.promise};Q.delay=function(object,timeout){if(timeout===void 0){timeout=object;object=void 0}return Q(object).delay(timeout)};Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();setTimeout(function(){deferred.resolve(value)},timeout);return deferred.promise})};Q.nfapply=function(callback,args){return Q(callback).nfapply(args)};Promise.prototype.nfapply=function(args){var deferred=defer();var nodeArgs=array_slice(args);nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise};Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)};Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise};Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());
Q(callback).fapply(nodeArgs).fail(deferred.reject);return deferred.promise}};Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);args.unshift(this);return Q.denodeify.apply(void 0,args)};Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());function bound(){return callback.apply(thisp,arguments)}Q(bound).fapply(nodeArgs).fail(deferred.reject);return deferred.promise}};Promise.prototype.nbind=function(){var args=array_slice(arguments,0);args.unshift(this);return Q.nbind.apply(void 0,args)};Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)};Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise};Q.nodeify=nodeify;function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}Promise.prototype.nodeify=function(nodeback){if(nodeback){this.then(function(value){Q.nextTick(function(){nodeback(null,value)})},function(error){Q.nextTick(function(){nodeback(error)})})}else{return this}};Q.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var qEndingLine=captureLine();return Q})}).call(exports,__webpack_require__(6),__webpack_require__(7).setImmediate)},function(module,exports){"use strict";var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports,__webpack_require__){(function(setImmediate,clearImmediate){"use strict";var nextTick=__webpack_require__(6).nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(exports,__webpack_require__(7).setImmediate,__webpack_require__(7).clearImmediate)},function(module,exports){"use strict";module.exports={WEBLET_URL:"https://www.mendeley.com/importer/",MAX_DOCUMENTS:100}},function(module,exports,__webpack_require__){"use strict";var config=__webpack_require__(8);var Q=__webpack_require__(5);var assign=__webpack_require__(10);var pdfScraper=__webpack_require__(11);var multipleDocumentScrapers=[__webpack_require__(14),__webpack_require__(15),__webpack_require__(17),__webpack_require__(18),__webpack_require__(24),__webpack_require__(25),__webpack_require__(26),__webpack_require__(27),__webpack_require__(31)];var singleDocumentScrapers=[__webpack_require__(19)];function testDocumentsMatch(firstDocument,secondDocument){var firstDocumentIdentifiers=firstDocument.metadata.identifiers;var secondDocumentIdentifiers=secondDocument.metadata.identifiers;if(!firstDocumentIdentifiers||!secondDocumentIdentifiers){return false}return Object.keys(firstDocumentIdentifiers).some(function(identifier){var firstDocumentIdentifier=firstDocumentIdentifiers[identifier];var secondDocumentIdentifier=secondDocumentIdentifiers[identifier];return secondDocumentIdentifier&&firstDocumentIdentifier.toLowerCase()===secondDocumentIdentifier.toLowerCase()})}function mergeDocuments(docs){return docs.reduce(function(merge,doc){var identifiers=assign({},merge.metadata.identifiers,doc.metadata.identifiers);var metadata=assign({},merge.metadata,doc.metadata);var identityJson=merge.identityJson||doc.identityJson;merge.metadata=metadata;merge.metadata.identifiers=identifiers;if(identityJson){merge.identityJson=identityJson}if(merge.fullTextLinks||doc.fullTextLinks){merge.fullTextLinks=merge.fullTextLinks||doc.fullTextLinks}return merge},{metadata:{}})}function runScrapers(domDocument,url,scrapers){if(!scrapers||scrapers.length===0){return Q([])}var i=0;function next(){return scrapers[i](domDocument,url).then(function(documents){if(documents.length===0&&++i<scrapers.length){return next()}return documents.slice(0,config.MAX_DOCUMENTS)})}return next()}function scrapeSpecific(domDocument,url,multipleDocumentScrapersOverride,singleDocumentScrapersOverride){var multipleDocScrapers=multipleDocumentScrapersOverride||multipleDocumentScrapers;var singleDocScrapers=singleDocumentScrapersOverride||singleDocumentScrapers;var multipleDocumentScrape=runScrapers(domDocument,url,multipleDocScrapers);var singleDocumentScrape=runScrapers(domDocument,url,singleDocScrapers);return Q.all([multipleDocumentScrape,singleDocumentScrape]).spread(function(multiScrapeResults,singleScrapeResults){if(!multiScrapeResults.length||!singleScrapeResults.length){return multiScrapeResults.length?multiScrapeResults:singleScrapeResults}var partition=multiScrapeResults.reduce(function(part,doc){if(testDocumentsMatch(singleScrapeResults[0],doc)){part[0].push(doc)}else{part[1].push(doc)}return part},[[],[]]);if(partition[0].length){partition[0].unshift(singleScrapeResults[0]);partition[0]=mergeDocuments(partition[0]);partition[0].mainDocument=true}return[].concat(partition[0],partition[1]).slice(0,config.MAX_DOCUMENTS)})}function scrape(domDocument,url,multipleDocumentScrapersOverride,singleDocumentScrapersOverride){return scrapeSpecific(domDocument,url,[],[pdfScraper]).then(function(documents){if(documents.length){return documents}else{return scrapeSpecific(domDocument,url,multipleDocumentScrapersOverride,singleDocumentScrapersOverride)}})}module.exports=scrape},function(module,exports){"use strict";"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(e){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(Object.getOwnPropertySymbols){symbols=Object.getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var PDF_TYPE="application/pdf";function buildDocument(url){var doc=new DocumentBuilder;doc.addFullTextLink(url);return Q([doc.document()])}function requestContentType(){return Q.Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("HEAD","",true);xhr.addEventListener("error",function(){reject()});xhr.addEventListener("load",function(){resolve(xhr.getResponseHeader("content-type"))});xhr.send()})}function contentTypeIsPDF(type){return typeof type==="string"&&type.toLowerCase()===PDF_TYPE}module.exports=function scrapePDF(domDocument,url){if(contentTypeIsPDF(domDocument.contentType)){return buildDocument(url)}var embedElement=domDocument.body.querySelector('embed[type="'+PDF_TYPE+'"]');if(embedElement!==null&&embedElement.src){return buildDocument(embedElement.src)}return requestContentType().then(function(contentType){if(contentTypeIsPDF(contentType)){return buildDocument(url)}return Q.reject()}).catch(function(){return Q([])})}},function(module,exports,__webpack_require__){"use strict";var parseUtils=__webpack_require__(13);var identWhiteList=["arxiv","doi","eid","isbn","issn","pii","pmid","scopus"];function validateArguments(fn){return function(){var args=Array.prototype.slice.call(arguments);var hasInvalidArgument=args.some(function(arg){return typeof arg==="undefined"||arg===null});if(args.length&&!hasInvalidArgument){fn.apply(this,args)}}}function DocumentBuilder(doc){if(doc){this.metadata=doc.metadata;if(doc.fullTextLinks){this.fullTextLinks=doc.fullTextLinks}}else{this.metadata={}}if(typeof this.metadata.type==="undefined"){this.metadata.type="journal"}if(typeof this.metadata.accessed==="undefined"){var timeZoneOffset=(new Date).getTimezoneOffset()*6e4;this.metadata.accessed=new Date(Date.now()-timeZoneOffset).toISOString().substr(0,10)}}function isVolumeValid(volumeText){return volumeText.length<=10}function isEditionValid(editionText){return editionText.length<=10}DocumentBuilder.isVolumeValid=isVolumeValid;DocumentBuilder.isEditionValid=isEditionValid;DocumentBuilder.prototype.setType=validateArguments(function(type){this.metadata.type=type});DocumentBuilder.prototype.addAuthor=validateArguments(function(author){if(!this.metadata.authors){this.metadata.authors=[]}this.metadata.authors.push(parseUtils.parseAuthor(author))});DocumentBuilder.prototype.addAuthors=validateArguments(function(authors){if(!this.metadata.authors){this.metadata.authors=[]}this.metadata.authors=this.metadata.authors.concat(parseUtils.parseAuthorList(authors))});DocumentBuilder.prototype.addFullTextLink=validateArguments(function(url){if(!this.fullTextLinks){this.fullTextLinks=[]}this.fullTextLinks.push(url)});DocumentBuilder.prototype.addIdent=validateArguments(function(type,value){if(typeof value==="string"){value=value.trim()}if(!value||identWhiteList.indexOf(type.toLowerCase())===-1){return}if(!this.metadata.identifiers){this.metadata.identifiers={}}this.metadata.identifiers[type]=value});DocumentBuilder.prototype.addKeyword=validateArguments(function(keyword){if(!this.metadata.keywords){this.metadata.keywords=[]}if(keyword.length<=50){this.metadata.keywords.push(keyword)}});DocumentBuilder.prototype.setTitle=validateArguments(function(title){this.metadata.title=title.substr(0,255).trim()});DocumentBuilder.prototype.setSource=validateArguments(function(source){this.metadata.source=source});DocumentBuilder.prototype.setPublicationDate=validateArguments(function(date){var parsedDate=parseUtils.parseDateString(date);if(parsedDate.year){this.metadata.year=parsedDate.year}});DocumentBuilder.prototype.setAbstract=validateArguments(function(abstract){this.metadata.abstract=abstract.trim()});DocumentBuilder.prototype.setVolume=validateArguments(function(volume){if(isVolumeValid(volume)){this.metadata.volume=volume}});DocumentBuilder.prototype.setIssue=validateArguments(function(issue){this.metadata.issue=issue});DocumentBuilder.prototype.setPages=validateArguments(function(pages){this.metadata.pages=pages});DocumentBuilder.prototype.setPublisher=validateArguments(function(publisher){this.metadata.publisher=publisher});DocumentBuilder.prototype.addWebsite=validateArguments(function(url){if(!this.metadata.websites){this.metadata.websites=[]}this.metadata.websites.push(url)});DocumentBuilder.prototype.setEdition=validateArguments(function(edition){if(isEditionValid(edition)){this.metadata.edition=edition}});DocumentBuilder.prototype.setSeries=validateArguments(function(series){this.metadata.series=series});DocumentBuilder.prototype.setCity=validateArguments(function(city){this.metadata.city=city});DocumentBuilder.prototype.document=function(){var document={metadata:this.metadata};if(this.fullTextLinks){document.fullTextLinks=this.fullTextLinks}return document};module.exports=DocumentBuilder},function(module,exports){"use strict";function pickFirst(dict,keys,callback){if(Array.isArray(keys)){for(var i=0;i<keys.length;i++){var key=keys[i];if(dict.hasOwnProperty(key)){callback(dict[key][0]);return}}}else if(dict.hasOwnProperty(keys)){callback(dict[keys][0])}}function pickAll(dict,keys,callback){if(Array.isArray(keys)){for(var i=0;i<keys.length;i++){var key=keys[i];pickAll(dict,key,callback)}}else if(dict.hasOwnProperty(keys)){for(var j=0;j<dict[keys].length;j++){var value=dict[keys][j];callback(value)}}}function parseAuthor(author){var commaSeparator;var firstName;var lastName;var parts;author=author.trim();if(author.length===0){return}commaSeparator=author.indexOf(",");if(commaSeparator!==-1){firstName=author.slice(commaSeparator+1);lastName=author.slice(0,commaSeparator)}else{parts=author.split(/ +/);firstName=parts.slice(0,parts.length-1).join(" ");lastName=parts.slice(parts.length-1).join("")}firstName=firstName.trim();lastName=lastName.trim();return{first_name:firstName,last_name:lastName}}function parseAuthorList(authors){var potentialSeparators=[";",","];var firstFoundSeparator=potentialSeparators.find(function(separator){return authors.indexOf(separator)!==-1});return authors.split(firstFoundSeparator).map(function(author){return parseAuthor(author)}).filter(Boolean)}function parseDateString(date){var yearMatch=date.match(/[0-9]{4}/);if(yearMatch){return{year:parseInt(yearMatch[0],10)}}else{return{}}}function parseKeywords(keywordsList){var orderedSeparatorList=[";",",","-","â€“"];var separator=orderedSeparatorList.find(function(character){return keywordsList.indexOf(character)!==-1});return keywordsList.split(separator).map(function(chunk){return chunk.trim()})}var htmlToText=function(){var element=document.createElement("div");return function htmlToTextInner(str){element.innerHTML=str;str=element.textContent;element.innerHTML="";return str}}();module.exports={htmlToText:htmlToText,pickFirst:pickFirst,pickAll:pickAll,parseAuthor:parseAuthor,parseAuthorList:parseAuthorList,parseDateString:parseDateString,parseKeywords:parseKeywords}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var scrapeUtils=__webpack_require__(13);var SELECTORS={SEARCH_RESULT_ITEM:"#gs_ccl .gs_r",EXTRA_PDF_LINK:".gs_ggs.gs_fl a",LINK:".gs_ri h3.gs_rt > a",TITLE:".gs_ri h3.gs_rt",DETAILS:".gs_ri div.gs_a"};function isYear(dateString){return String(parseInt(dateString,10))===dateString}function getType(rawTitle){if(rawTitle.toLowerCase().indexOf("[book]")===0){return"book"}}function getTitle(rawTitle){return rawTitle.replace("â–º","").replace("&#x25ba;","").replace("&nbsp;","").replace(/\[.+\]/,"").replace("&hellip;","").replace("â€¦","").trim()}function hasPdf(rawTitle){return rawTitle.toLowerCase().indexOf("[pdf]")===0}function parseAuthorString(authorString){authorString=authorString.replace("â€¦","").replace("&hellip;","").trim();if(!authorString){return}var chunks=authorString.split(/\s+/);var author={last_name:chunks.pop()};if(chunks.length){author.first_name=chunks.join(" ")}return author}function getAuthorsList(authorsText){return authorsText.split(", ").reduce(function(authorList,authorString){var author=parseAuthorString(authorString);if(author){authorList.push(author.first_name+" "+author.last_name)}return authorList},[])}function getPublicationDetails(detailsText){var chunks=detailsText.split(", ");var result={};if(chunks.length===1){var firstChunkText=scrapeUtils.htmlToText(chunks[0]).trim();if(isYear(firstChunkText)){result.year=firstChunkText}else{result.source=firstChunkText}}else if(chunks.length){var lastChunk=chunks.pop();var lastChunkText=scrapeUtils.htmlToText(lastChunk).trim();result.source=scrapeUtils.htmlToText(chunks.join(", ")).replace("&hellip;","").replace("â€¦","").trim();if(isYear(lastChunkText)){result.year=lastChunkText}else{result.source+=", "+lastChunkText}}return result}function getExtraPdfUrl(resultEl){var extraPdfLinkEl=resultEl.querySelector(SELECTORS.EXTRA_PDF_LINK);if(extraPdfLinkEl&&hasPdf(extraPdfLinkEl.textContent)){return extraPdfLinkEl.href}}function parseResultItem(resultEl){var linkEl=resultEl.querySelector(SELECTORS.LINK);if(!linkEl){return}var titleEl=resultEl.querySelector(SELECTORS.TITLE);if(!titleEl){return}var builder=new DocumentBuilder;var url=linkEl.href;var rawTitle=titleEl.textContent.trim();var publicationType=getType(rawTitle);builder.addWebsite(url);if(publicationType){builder.setType(publicationType)}builder.setTitle(getTitle(rawTitle));if(!builder.metadata.title){return}var extraPdfUrl=getExtraPdfUrl(resultEl);if(extraPdfUrl){builder.addFullTextLink(extraPdfUrl)}else if(hasPdf(rawTitle)){builder.addFullTextLink(url)}var detailsEl=resultEl.querySelector(SELECTORS.DETAILS);if(detailsEl){var detailsTextChunks=detailsEl.textContent.trim().split(" - ");if(detailsTextChunks.length){var authorsText=detailsTextChunks[0].trim();if(authorsText&&authorsText[0]!=="â€¦"&&authorsText.slice(0,8)!=="&hellip;"){getAuthorsList(authorsText).forEach(function(authorString){builder.addAuthor(authorString)})}var publicationDetails=getPublicationDetails(detailsTextChunks[1].trim());if(publicationDetails.year){builder.setPublicationDate(publicationDetails.year)}if(publicationDetails.source){builder.setSource(publicationDetails.source)}}}return builder.document()}module.exports=function scrapeGoogleScholar(domDocument,url){if(url.indexOf("scholar.google.")===-1){return Q([])}var nodes=domDocument.querySelectorAll(SELECTORS.SEARCH_RESULT_ITEM);if(nodes.length===0){return Q([])}var docs=Array.prototype.reduce.call(nodes,function(list,resultEl){var details=parseResultItem(resultEl);if(details){list.push(details)}return list},[]);return Q(docs)}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var scrapeDOI=__webpack_require__(16);function getSelector(pageUrl){var pmcMatches=pageUrl.match(/PMC\d{6}/i);if(pmcMatches!==null){return'a[href*="'+pmcMatches[0]+'"][href$=".pdf"]'}else{return null}}module.exports=function scrapePubMedCentral(domDocument,url){if(url.indexOf("ncbi.nlm.nih.gov/pmc/")===-1){return Q([])}var selector=getSelector(url);var pdfLinkEl=domDocument.querySelector(selector);var pmidMetaEl=domDocument.querySelector('meta[name="citation_pmid"]');if(pmidMetaEl){return Q.fcall(function(){var doc=new DocumentBuilder;if(pdfLinkEl){doc.addFullTextLink(pdfLinkEl.href)}doc.addIdent("pmid",pmidMetaEl.getAttribute("content"));return[doc.document()]})}else{return scrapeDOI(domDocument,url)}}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var htmlToText=__webpack_require__(13).htmlToText;var DOI_REGEXES=[/\b(10[.][0-9]{4,}(?:[.][0-9]+)*\/(?:(?!["\']|\<\D|\/\D)\S)+)\b/g,/(?:(10[.][0-9]{4,}(?:[.][0-9]+)*\/(?:(?!["#?, ]|(<\/))\S)+))/gi];function extractDOI(domDocument){var matches;var html=domDocument.documentElement.outerHTML;matches=DOI_REGEXES.reduce(function(arr,expr){return arr.concat(html.match(expr)||[])},[]);matches=matches.map(function(match){var doi=decodeURIComponent(htmlToText(match)).trim();doi=doi.toUpperCase();if(doi.charAt(doi.length-1)===";"){doi=doi.slice(0,-1)}return doi});matches=matches.filter(function(doi,idx,arr){return arr.indexOf(doi)===idx});return matches}function hasDOI(str){return DOI_REGEXES.some(function(regex){return str.match(regex)!==null})}function extractLink(domDocument){var links;links=domDocument.querySelectorAll("a[href]");links=Array.prototype.slice.call(links);return links.reduce(function(reduced,link){if(hasDOI(decodeURIComponent(link.href))){reduced.push(link.href)}return reduced},[])}function findPDF(links,doi){var detectors=[function(link){link=decodeURIComponent(link);return link.toLowerCase().indexOf("/doi/pdf/"+doi.toLowerCase())>-1}];return links.find(function(link){return detectors.some(function(detector){return detector(link)})})}function generateDocuments(domDocument){var dois=extractDOI(domDocument);var links=extractLink(domDocument);return dois.map(function(doi){var doc=new DocumentBuilder;doc.addIdent("doi",doi);doc.addFullTextLink(findPDF(links,doi));return doc.document()})}module.exports=function scrapeDOI(domDocument){return Q(generateDocuments(domDocument))}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var markupDetectionSelectors=["#sdHeader #bodyResults .resultList a.cLink","#page-area #centerContent .svTitle",".body-container .article-content .article-title"];var PII_REGEX=/pii\/\w+/gi;function extractPII(str){if(!PII_REGEX.test(str)){return}return str.match(PII_REGEX)[0].split("/")[1]}function getIdentityJson(){return Q.Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.responseType="json";xhr.open("GET","/science/export/userIdentity",true);xhr.addEventListener("error",function(){reject()});xhr.addEventListener("load",function(){resolve(xhr.response)});xhr.send()})}function extractDocuments(domDocument,url){var mainDocumentPII=extractPII(url);var matches=domDocument.documentElement.innerHTML.match(PII_REGEX);if(!matches){return}matches=matches.filter(function(match,index,arr){return arr.indexOf(match)===index});return matches.map(extractPII).map(function(pii){var doc=new DocumentBuilder;doc.addIdent("pii",pii);doc=doc.document();if(pii===mainDocumentPII){doc.mainDocument=true}return doc})}function isScienceDirectPage(domDocument){return markupDetectionSelectors.some(function(selector){return domDocument.querySelector(selector)})}module.exports=function scrapeScienceDirect(domDocument,url){if(!isScienceDirectPage(domDocument)){return Q([])}var documents=extractDocuments(domDocument,url);if(!documents){return Q([])}return getIdentityJson().then(function(identityJson){return documents.map(function(doc){doc.identityJson=identityJson;return doc})})}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var scrapeMetaTags=__webpack_require__(19);var searchItemSelector='li[itemtype*="http://schema.org/Article"]';function scrapeSearchResults(domDocument){var searchItems=Array.prototype.slice.call(domDocument.querySelectorAll(searchItemSelector));var documentList=searchItems.reduce(function(docList,htmlElem){var tempDoc=new DocumentBuilder;tempDoc.setTitle(htmlElem.querySelector('h2[itemprop="headline"] a').textContent);tempDoc.addWebsite(htmlElem.querySelector('h2[itemprop="headline"] a').getAttribute("href"));var authors=Array.prototype.slice.call(htmlElem.querySelectorAll('li[itemprop="creator"]')).map(function(element){return element.innerHTML.replace(/<span.*<\/span>/,"")}).join(";");tempDoc.addAuthors(authors);tempDoc.setPublicationDate(htmlElem.querySelector('time[itemprop="datePublished"]').getAttribute("datetime"));tempDoc.setPublisher(htmlElem.querySelector("ul + div > div a").text);tempDoc.setVolume(htmlElem.querySelector("ul + div > div span").innerHTML.trim());tempDoc.setPages(htmlElem.querySelector("ul + div > div").textContent.replace(/.*, /,"").trim());docList.push(tempDoc.document());return docList},[]);return Q(documentList)}function isNatureHtmlPage(url){var endsWithPdf=url.split("?")[0].split("#")[0].match(/\.pdf$/i);return!endsWithPdf&&(url.indexOf("www.nature.com")!==-1||url.indexOf("//nature.com")!==-1)}function isSearchResultsPage(domDocument,url){return/nature\.com\/search\?q=.+/.test(url)&&domDocument.querySelector(searchItemSelector)!==null}function generatePdfPattern(url){var matches;var pattern;matches=url.match(/\/articles\/[a-z]+[0-9]+[a-z]*$/);if(matches){pattern=matches[0]+".pdf$";return new RegExp(pattern)}matches=url.match(/\/full\/[a-z]+[0-9]+[a-z]*\.html$/);if(matches){pattern=matches[0];pattern=pattern.replace("/full/","/pdf/");pattern=pattern.replace(".html",".pdf");pattern=pattern+"$";return new RegExp(pattern)}}function findPDFLink(domDocument,url){var pattern=generatePdfPattern(url);var allLinks;var pdfLink;if(!pattern){return}allLinks=Array.prototype.slice.call(domDocument.querySelectorAll("a[href]"));pdfLink=allLinks.find(function(link){return pattern.test(link.getAttribute("href"))});if(!pdfLink){return}return pdfLink.href}function scrapeDocumentPage(domDocument,url){return scrapeMetaTags(domDocument).then(function(docs){var doc=new DocumentBuilder(docs[0]);doc.addFullTextLink(findPDFLink(domDocument,url));docs[0]=doc.document();return docs})}module.exports=function scrapeNature(domDocument,url){if(!isNatureHtmlPage(url)){return Q([])}if(isSearchResultsPage(domDocument,url)){return scrapeSearchResults(domDocument)}return scrapeDocumentPage(domDocument,url)}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var assign=__webpack_require__(20);function mergeDocuments(scrapeResults){var flatResults=[].concat.apply([],scrapeResults);if(flatResults.length===0){return}return flatResults.reduce(function(curr,doc){return assign(curr,doc)},{})}module.exports=function scrapeMetaTags(domDocument){return Q.all([__webpack_require__(22)(domDocument),__webpack_require__(23)(domDocument)]).then(function(results){var mergedDocs=mergeDocuments(results);return mergedDocs?[mergedDocs]:[]})}},function(module,exports,__webpack_require__){"use strict";"use strict";var isObj=__webpack_require__(21);var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Sources cannot be null or undefined")}return Object(val)}function assignKey(to,from,key){var val=from[key];if(val===undefined||val===null){return}if(hasOwnProperty.call(to,key)){if(to[key]===undefined||to[key]===null){throw new TypeError("Cannot convert undefined or null to object ("+key+")")}}if(!hasOwnProperty.call(to,key)||!isObj(val)){to[key]=val}else{to[key]=assign(Object(to[key]),from[key])}}function assign(to,from){if(to===from){return to}from=Object(from);for(var key in from){if(hasOwnProperty.call(from,key)){assignKey(to,from,key)}}if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){assignKey(to,from,symbols[i])}}}return to}module.exports=function deepAssign(target){target=toObject(target);for(var s=1;s<arguments.length;s++){assign(target,arguments[s])}return target}},function(module,exports){"use strict";"use strict";module.exports=function(x){var type=typeof x;return x!==null&&(type==="object"||type==="function")}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var scrapeUtils=__webpack_require__(13);var DocumentBuilder=__webpack_require__(12);var pickFirst=scrapeUtils.pickFirst;var pickAll=scrapeUtils.pickAll;var CITATION_META_TAGS_SELECTOR='meta[name^="citation_"]';function extendMetaTagDict(dict,name,value){if(name==="citation_reference"){value.split(";").map(function(keyValuePair){var parts=keyValuePair.split("=");var paramName=parts[0].trim();var content=parts.slice(1).join("=").trim();return[paramName,content]}).filter(function(entry){return entry[0]&&entry[1]}).forEach(function(attr){extendMetaTagDict(dict,attr[0],attr[1])})}else if(dict[name]){dict[name].push(value)}else{dict[name]=[value]}}function typeFromCitationTags(metaTagDict){var keys=Object.keys(metaTagDict);for(var i=0;i<keys.length;i++){if(keys[i].indexOf("citation_journal")!==-1){return"journal"}}if("citation_isbn"in metaTagDict){return"book"}return"generic"}function documentFromCitationMetaTags(metaTagDict){var doc=new DocumentBuilder;doc.setType(typeFromCitationTags(metaTagDict));pickFirst(metaTagDict,"citation_title",function(title){doc.setTitle(title)});pickAll(metaTagDict,"citation_author",function(author){
doc.addAuthor(author)});pickAll(metaTagDict,"citation_authors",function(authorList){doc.addAuthors(authorList)});pickFirst(metaTagDict,["citation_publication_date","citation_date"],function(date){doc.setPublicationDate(date)});pickFirst(metaTagDict,"citation_abstract",function(abstract){doc.setAbstract(abstract)});pickFirst(metaTagDict,"citation_volume",function(volume){doc.setVolume(volume)});pickFirst(metaTagDict,"citation_issue",function(issue){doc.setIssue(issue)});var pages;pickFirst(metaTagDict,["citation_pages","citation_firstpage"],function(page){pages=page});if(pages&&pages.indexOf("-")===-1){pickFirst(metaTagDict,["citation_lastpage"],function(lastPage){pages+="-"+lastPage})}if(pages){doc.setPages(pages)}pickFirst(metaTagDict,"citation_doi",function(doi){doc.addIdent("doi",doi.toLowerCase().replace("doi:","").trim())});pickFirst(metaTagDict,"citation_pmid",function(pmid){doc.addIdent("pmid",pmid)});pickFirst(metaTagDict,"citation_issn",function(issn){doc.addIdent("issn",issn)});pickFirst(metaTagDict,"citation_isbn",function(isbn){doc.addIdent("isbn",isbn)});pickFirst(metaTagDict,"citation_arxiv_id",function(arxiv){doc.addIdent("arxiv",arxiv)});pickFirst(metaTagDict,"citation_pii",function(pii){doc.addIdent("pii",pii)});pickFirst(metaTagDict,"citation_pdf_url",function(url){doc.addFullTextLink(url)});pickFirst(metaTagDict,["citation_journal_title","citation_journal_abbrev","citation_journal_title_abbrev","citation_conference"],function(journal){doc.setSource(journal)});pickFirst(metaTagDict,"citation_publisher",function(publisher){doc.setPublisher(publisher)});pickAll(metaTagDict,"citation_keyword",function(keyword){doc.addKeyword(keyword)});pickAll(metaTagDict,"citation_keywords",function(keywords){scrapeUtils.parseKeywords(keywords).forEach(function(keyword){doc.addKeyword(keyword)})});return doc.document()}module.exports=function scrapeCitationMetaTags(domDocument){var metaTags=domDocument.querySelectorAll(CITATION_META_TAGS_SELECTOR);if(metaTags.length===0){return Q([])}var metaTagDict=Array.prototype.reduce.call(metaTags,function(dict,tagElement){var name=tagElement.name;var content=tagElement.content;if(name!==""&&content!==""){extendMetaTagDict(dict,name,content)}return dict},{});var doc=documentFromCitationMetaTags(metaTagDict);return Q([doc])}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var scrapeUtils=__webpack_require__(13);var DocumentBuilder=__webpack_require__(12);var pickFirst=scrapeUtils.pickFirst;var pickAll=scrapeUtils.pickAll;var DUBLIN_CORE_META_TAGS_SELECTOR='meta[name^="dc."], meta[name^="DC."]';function extractAttributes(attributes){var obj={};for(var i=0,j=attributes.length;i<j;i++){var attr=attributes[i];obj[attr.name]=attr.value}return obj}function extendMetaTagDict(dict,name,attributes){var attributesObj=extractAttributes(attributes);if(dict[name]){dict[name].push(attributesObj)}else{dict[name]=[attributesObj]}}function documentFromDublinCoreMetaTags(metaTagDict){var doc=new DocumentBuilder;pickAll(metaTagDict,"dc.identifier",function(ident){doc.addIdent(ident.scheme,ident.content)});pickFirst(metaTagDict,"dc.title",function(title){doc.setTitle(title.content)});pickAll(metaTagDict,"dc.creator",function(author){doc.addAuthor(author.content)});pickFirst(metaTagDict,["dc.date","dc.date.published"],function(date){doc.setPublicationDate(date.content)});pickFirst(metaTagDict,"dc.publisher",function(publisher){doc.setPublisher(publisher.content)});pickFirst(metaTagDict,"dc.source",function(source){doc.setSource(source.content)});pickFirst(metaTagDict,"dc.description",function(abstract){doc.setAbstract(abstract.content)});pickAll(metaTagDict,["dc.keywords","dc.subject"],function(keywords){scrapeUtils.parseKeywords(keywords.content).forEach(function(keyword){doc.addKeyword(keyword)})});return doc.document()}module.exports=function scrapeDublinCoreMetaTags(domDocument){var metaTags=domDocument.querySelectorAll(DUBLIN_CORE_META_TAGS_SELECTOR);if(metaTags.length===0){return Q([])}var metaTagDict=Array.prototype.reduce.call(metaTags,function(dict,tagElement){var name=tagElement.name;var content=tagElement.content;if(name!==""&&content!==""){extendMetaTagDict(dict,name.toLowerCase(),tagElement.attributes)}return dict},{});if(Object.keys(metaTagDict).length===0){return Q([])}var doc=documentFromDublinCoreMetaTags(metaTagDict);return Q([doc])}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var EID_REGEX=/2-s2.0-\d{10,11}/g;function getIdentityJson(){return Q.Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.responseType="json";xhr.open("GET","/get/authtoken.uri",true);xhr.addEventListener("error",function(){reject()});xhr.addEventListener("load",function(){resolve(xhr.response)});xhr.send()})}function createDocument(eid,isMain){var doc=new DocumentBuilder;doc.addIdent("eid",eid);if(isMain){doc.mainDocument=true}return doc.document()}function extractDocuments(domDocument,url){var matches;var resultPageCheckboxes=domDocument.querySelectorAll('#sciverseCanvasArea .documentDataList input[name="selectedEIDs"]');var anyCheckboxSelected=Array.prototype.some.call(resultPageCheckboxes,function(checkboxEl){return checkboxEl.checked});var isSingleDocumentPage=domDocument.querySelectorAll("#sciverseCanvasArea h1.svTitle, #sciverseCanvasArea #authorlist").length===2;if(isSingleDocumentPage){matches=url.match(EID_REGEX)||[];return matches.map(function(eid){return createDocument(eid,true)})}else if(resultPageCheckboxes.length){return Array.prototype.reduce.call(resultPageCheckboxes,function(list,checkboxEl){if(!anyCheckboxSelected||checkboxEl.checked){list.push(createDocument(checkboxEl.value))}return list},[])}return[]}module.exports=function scrapeScopus(domDocument,url){var docs=extractDocuments(domDocument,url);if(docs.length){return getIdentityJson().then(function(identityJson){return docs.map(function(doc){doc.identityJson=identityJson;return doc})})}return Q([])}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var metaTagsScraper=__webpack_require__(19);module.exports=function scrapeWhoDotInt(domDocument,url){if(url.indexOf("who.int")<0){return Q([])}return metaTagsScraper(domDocument).then(function(docs){if(docs.length===0||docs[0].fullTextLinks){return docs}if(url.indexOf("csr/resources/publications")<0){return docs}var pdfLink=domDocument.querySelector(".pubmeta a[href*=pdf]");if(!pdfLink){return docs}docs[0]=new DocumentBuilder(docs[0]);docs[0].addFullTextLink(pdfLink.href);docs[0]=docs[0].document();return docs})}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var COINS_SELECTOR="span.Z3988";function getContextObject(span){var ctx=span.title;if(!ctx){return null}return ctx.split("&").reduce(function(obj,pair){var key=pair.split("=")[0];var value=pair.split("=")[1];try{value=value.replace(/\+/g," ");value=decodeURIComponent(value)}catch(e){}if(key!=="rft_id"&&key!=="rft.au"){obj[key]=value}else{if(typeof obj[key]==="undefined"){obj[key]=[]}obj[key].push(value)}return obj},{})}function processJournalFields(docBuilder,ctx){docBuilder.setTitle(ctx["rft.atitle"]);docBuilder.setSource(ctx["rft.jtitle"]||ctx["rft.title"]||ctx["rft.stitle"]);docBuilder.setVolume(ctx["rft.volume"]);docBuilder.setIssue(ctx["rft.issue"])}function processBookFields(docBuilder,ctx){docBuilder.setType("book");docBuilder.setTitle(ctx["rft.btitle"]);docBuilder.setPublisher(ctx["rft.pub"]);docBuilder.setSeries(ctx["rft.series"]);docBuilder.setEdition(ctx["rft.edition"]);docBuilder.setCity(ctx["rft.place"])}function processAuthorFields(docBuilder,ctx){var authors=[];var firstName=ctx["rft.aufirst"]||"";var lastName=ctx["rft.aulast"]||"";var primaryAuthor=(firstName+" "+lastName).trim();var otherAuthors=ctx["rft.au"]||[];if(primaryAuthor){authors.push(primaryAuthor)}authors.concat(otherAuthors).forEach(function(author){docBuilder.addAuthor(author)})}function processIdFields(docBuilder,ctx){var ids=ctx.rft_id;if(!ids){return}ids.forEach(function(id){if(id.indexOf("http")===0){docBuilder.addWebsite(id)}else if(id.indexOf("info:doi/")===0){docBuilder.addIdent("doi",id.replace("info:doi/",""))}else if(id.indexOf("info:pmid/")===0){docBuilder.addIdent("pmid",id.replace("info:pmid/",""))}})}function processCommonFields(docBuilder,ctx){docBuilder.addIdent("issn",ctx["rft.issn"]);docBuilder.addIdent("isbn",ctx["rft.isbn"]);docBuilder.setPages(ctx["rft.pages"]);docBuilder.setPublicationDate(ctx["rft.date"]);processIdFields(docBuilder,ctx);processAuthorFields(docBuilder,ctx)}function getDocument(span){var ctx=getContextObject(span);var docBuilder=new DocumentBuilder;if(!ctx){return null}if(ctx.rft_val_fmt==="info:ofi/fmt:kev:mtx:journal"){processJournalFields(docBuilder,ctx)}else if(ctx.rft_val_fmt==="info:ofi/fmt:kev:mtx:book"){processBookFields(docBuilder,ctx)}else{return null}processCommonFields(docBuilder,ctx);return docBuilder.document()}module.exports=function scrapeCoins(domDocument){var spans=domDocument.querySelectorAll(COINS_SELECTOR);var spansMap={};var docs=[];for(var i=0;i<spans.length;i++){var span=spans[i];var doc=null;if(typeof spansMap[span.title]==="undefined"){spansMap[span.title]=true;doc=getDocument(span)}if(doc){docs.push(doc)}}return Q(docs)}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var scrapers=[__webpack_require__(28),__webpack_require__(16),__webpack_require__(29),__webpack_require__(30)];function scrape(domDocument){return Q.all(scrapers.map(function(scraper){return scraper(domDocument)}))}function concatDocuments(){return Array.prototype.reduce.call(arguments,function(reduced,docs){return reduced.concat(docs)},[])}module.exports=function scrapeAllIds(domDocument){return scrape(domDocument).spread(concatDocuments)}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var ARXIV_ID_FORMAT=/arXiv\:[a-z0-9\-]+?(?:\.|\/)\d+(?:v\d+)?/g;function getPdfLinkSelector(id){return'a[href$="/pdf/'+id+'"][title="Download PDF"]'}function scrapeIds(domDocument){var html=domDocument.documentElement.outerHTML;var matches=html.match(ARXIV_ID_FORMAT);if(matches===null){return[]}matches=matches.map(function(arxiv){return arxiv.replace("arXiv:","")});return matches.filter(function(arxiv,index){return matches.indexOf(arxiv)===index})}module.exports=function scrapeArxiv(domDocument){var docs=scrapeIds(domDocument).map(function(id){var builder=new DocumentBuilder;var linkSelector=getPdfLinkSelector(id);var link=domDocument.querySelector(linkSelector);builder.addIdent("arxiv",id);if(link){builder.addFullTextLink(link.href)}return builder.document()});return Q(docs)}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var PUBMEDID_REGEX=/pmid:\s?(\d+)/gi;module.exports=function scrapePubMedID(domDocument){var textContent=domDocument.body.textContent;var matches=[];var match=PUBMEDID_REGEX.exec(textContent);while(match!==null){matches.push(match[1]);match=PUBMEDID_REGEX.exec(textContent)}if(matches.length===0){return Q([])}var docs=matches.filter(function(pmid,index){return matches.indexOf(pmid)===index}).map(function(pmid){var doc=new DocumentBuilder;doc.addIdent("pmid",pmid);return doc.document()});return Q(docs)}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);var ISBN_REGEX=/ISBN-?\s?(?:10|13)?:?\s?([\s0-9-]{10,16}[0-9x]{1})/gi;module.exports=function scrapeISBN(domDocument){var html=domDocument.documentElement.outerHTML;var matches=[];html.replace(ISBN_REGEX,function(match,group0){matches.push(group0)});if(matches.length===0){return Q([])}var docs=matches.filter(function(isbn,index){return matches.indexOf(isbn)===index}).map(function(isbn){var doc=new DocumentBuilder;doc.addIdent("isbn",isbn);return doc.document()});return Q(docs)}},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(5);var DocumentBuilder=__webpack_require__(12);function extractFromGoogleBooks(doc){try{var isbnRowEl=Array.prototype.find.call(doc.querySelectorAll(".metadata_row "),function(el){var labelEl=el.querySelector(".metadata_label span");return labelEl&&labelEl.textContent.trim()==="ISBN"});return isbnRowEl.querySelector(".metadata_value span").textContent.split(",")}catch(err){return[]}}module.exports=function scrapeGoogleBooks(domDocument){var matches=extractFromGoogleBooks(domDocument);if(matches.length===0){return Q([])}var docs=matches.filter(function(isbn,index){return matches.indexOf(isbn)===index}).map(function(isbn,i){var doc=new DocumentBuilder;doc.addIdent("isbn",isbn);doc=doc.document();if(i===0){doc.mainDocument=true}return doc});return Q(docs)}}]);